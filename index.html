<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Event Check-in</title>
        
        <!-- ‚úÖ Correct QR Scanner Library (Use this!) -->
        <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
        
        <style>
            body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
            #qr-reader { width: 300px; margin: 20px auto; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
            th { background-color: #f4f4f4; }
        </style>
    </head>
    
    <body>
        <h2>üéüÔ∏è Event Check-in System</h2>

        <!-- QR Code Scanner -->
        <h3>üì∑ Scan Ticket QR Code</h3>
        <div id="qr-reader"></div>
        <p id="status"></p>

        <!-- Registered Participants Table -->
        <h3>üìã Registered Participants</h3>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="participants"></tbody>
        </table>

        <script>
            window.onload = function () {
                const qrReader = new Html5Qrcode("qr-reader");
                
                qrReader.start(
                    { facingMode: "environment" },  // Use rear camera
                    { fps: 10, qrbox: { width: 250, height: 250 } },
                    function onScanSuccess(qrMessage) {
                        document.getElementById("status").innerText = "Checking in...";
                        
                        fetch(`https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?id=${qrMessage}`)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById("status").innerText = data.message;
                            loadParticipants();  // Refresh list
                        })
                        .catch(error => console.error("Error:", error));
                    },
                    function onScanError(errorMessage) {
                        console.warn(errorMessage);  // Handle errors silently
                    }
                ).catch(err => console.error("QR Scanner Error:", err));
                
                loadParticipants();  // Load initial participant list
            };

    function loadParticipants() {
        fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec")
        .then(response => response.json())
        .then(data => {
            let html = "";
            data.forEach(p => {
                html += `<tr><td>${p.name}</td><td>${p.email}</td><td>${p.status}</td></tr>`;
            });
            document.getElementById("participants").innerHTML = html;
        });
    }
            function onScanSuccess(qrMessage) {
                document.getElementById("status").innerText = "Checking in...";
                
                fetch(`https://script.google.com/macros/s/AKfycbwWFhR8yIhpo9gmO_OEWSoBL10nEe_YaOmvv7Fi_5wgkF0UHT9jGbE_3PXRDnvdVuWceA/exec?id=${qrMessage}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("status").innerText = data.message;
                    loadParticipants();  // Refresh list
                })
                .catch(error => console.error("Error:", error));
            }

            function loadParticipants() {
                fetch("https://script.google.com/macros/s/AKfycbwWFhR8yIhpo9gmO_OEWSoBL10nEe_YaOmvv7Fi_5wgkF0UHT9jGbE_3PXRDnvdVuWceA/exec")
                .then(response => response.json())
                .then(data => {
                    let html = "";
                    data.forEach(p => {
                        html += `<tr><td>${p.name}</td><td>${p.email}</td><td>${p.status}</td></tr>`;
                    });
                    document.getElementById("participants").innerHTML = html;
                });
            }

            var html5QrCode = new Html5Qrcode("qr-reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, onScanSuccess);
            
            loadParticipants();  // Load initial list
        </script>
    </body>
</html>
